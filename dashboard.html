<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ‚Äî AiTelDa</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Instrument+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root{--bg:#050508;--surface:#0c0c14;--border:#1a1a2e;--accent:#00e5a0;--accent2:#ff4d00;--accent3:#7b61ff;--text:#e8e8f0;--muted:#6b6b80;--card:#0f0f1a;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Instrument Sans',sans-serif;min-height:100vh;cursor:none;display:flex;}
  .cursor{position:fixed;width:10px;height:10px;background:var(--accent);border-radius:50%;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:width .2s,height .2s;}
  .cursor-ring{position:fixed;width:36px;height:36px;border:1px solid rgba(0,229,160,0.4);border-radius:50%;pointer-events:none;z-index:9998;transform:translate(-50%,-50%);transition:width .3s,height .3s;}
  body::after{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,160,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,160,0.02) 1px,transparent 1px);background-size:60px 60px;pointer-events:none;z-index:0;}

  /* SIDEBAR */
  .sidebar{width:240px;min-height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:50;}
  .sidebar-logo{padding:28px 24px;border-bottom:1px solid var(--border);}
  .sidebar-logo a{font-family:'Syne',sans-serif;font-weight:800;font-size:1.3rem;letter-spacing:-0.02em;color:var(--text);text-decoration:none;}
  .sidebar-logo a span{color:var(--accent);}

  .sidebar-nav{flex:1;padding:16px 0;}
  .nav-section-label{font-family:'Space Mono',monospace;font-size:0.58rem;color:var(--muted);letter-spacing:.18em;text-transform:uppercase;padding:12px 24px 8px;}
  .nav-item{display:flex;align-items:center;gap:12px;padding:11px 24px;font-size:0.88rem;color:var(--muted);cursor:pointer;text-decoration:none;transition:background .2s,color .2s;position:relative;}
  .nav-item:hover,.nav-item.active{background:rgba(0,229,160,0.05);color:var(--text);}
  .nav-item.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--accent);}
  .nav-icon{font-size:1rem;width:20px;text-align:center;flex-shrink:0;}
  .nav-badge{margin-left:auto;font-family:'Space Mono',monospace;font-size:0.6rem;background:var(--accent2);color:#fff;padding:2px 7px;border-radius:2px;}

  .sidebar-footer{padding:20px 24px;border-top:1px solid var(--border);}
  .user-chip{display:flex;align-items:center;gap:10px;}
  .user-avatar{width:34px;height:34px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:0.8rem;color:#000;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,0 100%);flex-shrink:0;}
  .user-info{flex:1;min-width:0;}
  .user-name{font-size:0.85rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .user-role{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;}
  .logout-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.9rem;transition:color .2s;padding:4px;}
  .logout-btn:hover{color:var(--accent2);}

  /* MAIN */
  .main{margin-left:240px;flex:1;display:flex;flex-direction:column;min-height:100vh;position:relative;z-index:1;}

  /* TOP BAR */
  .topbar{padding:24px 40px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,8,0.8);backdrop-filter:blur(12px);position:sticky;top:0;z-index:40;}
  .topbar-title{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;}
  .topbar-sub{font-family:'Space Mono',monospace;font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-top:2px;}
  .topbar-actions{display:flex;gap:12px;align-items:center;}
  .status-pill{display:flex;align-items:center;gap:6px;padding:6px 14px;border:1px solid var(--border);font-family:'Space Mono',monospace;font-size:0.65rem;color:var(--accent);letter-spacing:.08em;text-transform:uppercase;}
  .status-dot{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 2s ease-in-out infinite;}
  @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}

  /* CONTENT */
  .content{padding:36px 40px;flex:1;}

  /* STAT CARDS */
  .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px;}
  .stat-card{background:var(--card);border:1px solid var(--border);padding:24px;position:relative;overflow:hidden;transition:border-color .2s;}
  .stat-card:hover{border-color:rgba(0,229,160,0.2);}
  .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
  .stat-card:nth-child(1)::before{background:var(--accent);}
  .stat-card:nth-child(2)::before{background:var(--accent3);}
  .stat-card:nth-child(3)::before{background:#ffbd2e;}
  .stat-card:nth-child(4)::before{background:var(--accent2);}
  .stat-label{font-family:'Space Mono',monospace;font-size:0.62rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:12px;}
  .stat-value{font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;line-height:1;}
  .stat-sub{font-family:'Space Mono',monospace;font-size:0.62rem;color:var(--muted);margin-top:8px;}
  .stat-icon{position:absolute;top:20px;right:20px;font-size:1.4rem;opacity:.2;}

  /* TWO-COL GRID */
  .dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
  .dash-grid.wide{grid-template-columns:3fr 2fr;}
  .panel{background:var(--card);border:1px solid var(--border);clip-path:polygon(0 0,calc(100% - 12px) 0,100% 12px,100% 100%,0 100%);}
  .panel-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .panel-title{font-family:'Syne',sans-serif;font-size:0.95rem;font-weight:700;}
  .panel-tag{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--accent);background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.15);padding:3px 8px;letter-spacing:.08em;}
  .panel-body{padding:20px 24px;}

  /* APP USAGE BARS */
  .app-item{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
  .app-item:last-child{margin-bottom:0;}
  .app-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
  .app-name{font-size:0.88rem;flex:1;min-width:0;}
  .app-uid{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);display:block;margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .app-bar-wrap{width:120px;flex-shrink:0;}
  .app-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-bottom:4px;}
  .app-bar-fill{height:100%;border-radius:2px;transition:width 1s ease;}
  .app-bytes{font-family:'Space Mono',monospace;font-size:0.62rem;color:var(--muted);text-align:right;}

  /* ANOMALY LIST */
  .anomaly-item{display:flex;gap:14px;padding:14px 0;border-bottom:1px solid var(--border);}
  .anomaly-item:last-child{border-bottom:none;}
  .anomaly-sev{width:6px;border-radius:3px;align-self:stretch;flex-shrink:0;}
  .anomaly-sev.high{background:var(--accent2);}
  .anomaly-sev.medium{background:#ffbd2e;}
  .anomaly-sev.low{background:var(--accent);}
  .anomaly-app{font-family:'Space Mono',monospace;font-size:0.72rem;color:var(--text);margin-bottom:4px;}
  .anomaly-detail{font-size:0.8rem;color:var(--muted);}
  .anomaly-time{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);margin-left:auto;flex-shrink:0;padding-top:2px;}

  /* DISPUTES TABLE */
  .dispute-table{width:100%;border-collapse:collapse;}
  .dispute-table th{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;text-align:left;padding:0 12px 12px;border-bottom:1px solid var(--border);}
  .dispute-table td{font-size:0.84rem;padding:14px 12px;border-bottom:1px solid rgba(26,26,46,0.6);vertical-align:middle;}
  .dispute-table tr:last-child td{border-bottom:none;}
  .dispute-table tr:hover td{background:rgba(0,229,160,0.02);}
  .ref-code{font-family:'Space Mono',monospace;font-size:0.72rem;color:var(--accent);}
  .status-badge{font-family:'Space Mono',monospace;font-size:0.6rem;padding:3px 8px;letter-spacing:.06em;text-transform:uppercase;}
  .status-badge.submitted{background:rgba(0,229,160,0.1);color:var(--accent);border:1px solid rgba(0,229,160,0.2);}
  .status-badge.pending{background:rgba(255,189,46,0.1);color:#ffbd2e;border:1px solid rgba(255,189,46,0.2);}
  .status-badge.resolved{background:rgba(123,97,255,0.1);color:var(--accent3);border:1px solid rgba(123,97,255,0.2);}
  .status-badge.pdf_generated{background:rgba(0,229,160,0.06);color:var(--muted);border:1px solid var(--border);}
  .action-btn{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);background:none;border:1px solid var(--border);padding:4px 10px;cursor:pointer;transition:color .2s,border-color .2s;text-transform:uppercase;letter-spacing:.06em;text-decoration:none;}
  .action-btn:hover{color:var(--accent);border-color:var(--accent);}

  /* VARIANCE METER */
  .variance-meter{margin:16px 0;}
  .variance-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
  .variance-label{font-family:'Space Mono',monospace;font-size:0.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;}
  .variance-val{font-family:'Space Mono',monospace;font-size:0.75rem;color:var(--text);}
  .variance-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin-bottom:16px;}
  .variance-fill{height:100%;border-radius:3px;transition:width 1.2s ease;}

  /* QUICK ACTIONS */
  .quick-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .qa-btn{display:flex;align-items:center;gap:10px;padding:14px 16px;background:var(--surface);border:1px solid var(--border);cursor:pointer;transition:border-color .2s,background .2s;text-align:left;text-decoration:none;color:var(--text);}
  .qa-btn:hover{border-color:rgba(0,229,160,0.3);background:rgba(0,229,160,0.03);}
  .qa-icon{font-size:1.2rem;flex-shrink:0;}
  .qa-label{font-size:0.84rem;font-weight:500;}
  .qa-sub{font-family:'Space Mono',monospace;font-size:0.6rem;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-top:2px;}

  /* Loading skeleton */
  .skeleton{background:linear-gradient(90deg,var(--border) 25%,rgba(26,26,46,0.8) 50%,var(--border) 75%);background-size:200% 100%;animation:skel 1.4s ease infinite;}
  @keyframes skel{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
  .skel-line{height:14px;border-radius:2px;margin-bottom:10px;}

  /* Empty state */
  .empty{text-align:center;padding:40px 20px;}
  .empty-icon{font-size:2.5rem;margin-bottom:12px;}
  .empty-text{font-family:'Space Mono',monospace;font-size:0.72rem;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;}

  @media(max-width:1024px){.stats-grid{grid-template-columns:1fr 1fr;}.dash-grid,.dash-grid.wide{grid-template-columns:1fr;}}
  @media(max-width:768px){.sidebar{display:none;}.main{margin-left:0;}.topbar{padding:16px 20px;}.content{padding:20px;}.stats-grid{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>

<div class="cursor" id="cursor"></div>
<div class="cursor-ring" id="cursorRing"></div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <a href="index.html">Ai<span>Tel</span>Da</a>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Monitoring</div>
    <a href="dashboard.html" class="nav-item active">
      <span class="nav-icon">üìä</span> Dashboard
    </a>
    <a href="#" class="nav-item">
      <span class="nav-icon">üì°</span> Packet Sessions
    </a>
    <a href="#" class="nav-item">
      <span class="nav-icon">‚ö†Ô∏è</span> Anomaly Events
      <span class="nav-badge" id="anomalyBadge">3</span>
    </a>
    <div class="nav-section-label">Disputes</div>
    <a href="#" class="nav-item">
      <span class="nav-icon">‚öñÔ∏è</span> My Disputes
    </a>
    <a href="#" class="nav-item">
      <span class="nav-icon">üìÑ</span> Reports
    </a>
    <div class="nav-section-label">Device</div>
    <a href="#" class="nav-item">
      <span class="nav-icon">üì±</span> My Devices
    </a>
    <a href="#" class="nav-item">
      <span class="nav-icon">üìà</span> Analytics
    </a>
    <div class="nav-section-label">Account</div>
    <a href="#" class="nav-item">
      <span class="nav-icon">‚öôÔ∏è</span> Settings
    </a>
  </nav>
  <div class="sidebar-footer">
    <div class="user-chip">
      <div class="user-avatar" id="userAvatar">‚Äî</div>
      <div class="user-info">
        <div class="user-name" id="userName">Loading...</div>
        <div class="user-role">Consumer</div>
      </div>
      <button class="logout-btn" onclick="logout()" title="Logout">‚èª</button>
    </div>
  </div>
</aside>

<!-- MAIN CONTENT -->
<main class="main">
  <div class="topbar">
    <div>
      <div class="topbar-title">Audit Dashboard</div>
      <div class="topbar-sub" id="topbarDate">Loading...</div>
    </div>
    <div class="topbar-actions">
      <div class="status-pill"><div class="status-dot"></div>Packet-Sentry Active</div>
    </div>
  </div>

  <div class="content">
    <!-- STATS ROW -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Data Monitored</div>
        <div class="stat-value" id="statBytes">‚Äî</div>
        <div class="stat-sub" id="statBytesSub">this month</div>
        <div class="stat-icon">üì°</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Anomalies Detected</div>
        <div class="stat-value" id="statAnomalies">‚Äî</div>
        <div class="stat-sub">last 30 days</div>
        <div class="stat-icon">‚ö†Ô∏è</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Disputes Filed</div>
        <div class="stat-value" id="statDisputes">‚Äî</div>
        <div class="stat-sub" id="statDisputesSub">‚Äî</div>
        <div class="stat-icon">‚öñÔ∏è</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Devices Registered</div>
        <div class="stat-value" id="statDevices">‚Äî</div>
        <div class="stat-sub">connected</div>
        <div class="stat-icon">üì±</div>
      </div>
    </div>

    <!-- ROW 2: App usage + Anomalies -->
    <div class="dash-grid wide" style="margin-bottom:20px;">
      <!-- App breakdown -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Top App Consumers</span>
          <span class="panel-tag">Last 30 days</span>
        </div>
        <div class="panel-body" id="appList">
          <div class="skel-line skeleton" style="width:100%"></div>
          <div class="skel-line skeleton" style="width:85%"></div>
          <div class="skel-line skeleton" style="width:70%"></div>
          <div class="skel-line skeleton" style="width:55%"></div>
          <div class="skel-line skeleton" style="width:40%"></div>
        </div>
      </div>

      <!-- Anomaly feed -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Recent Anomalies</span>
          <span class="panel-tag" id="anomalyCount" style="background:rgba(255,77,0,0.08);color:var(--accent2);border-color:rgba(255,77,0,0.2);">Loading</span>
        </div>
        <div class="panel-body" id="anomalyList">
          <div class="skel-line skeleton" style="width:100%"></div>
          <div class="skel-line skeleton" style="width:90%"></div>
          <div class="skel-line skeleton" style="width:75%"></div>
        </div>
      </div>
    </div>

    <!-- ROW 3: Disputes table + Quick actions -->
    <div class="dash-grid" style="margin-bottom:20px;">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Dispute Cases</span>
          <a href="#" class="panel-tag" style="text-decoration:none;cursor:pointer;">New Dispute +</a>
        </div>
        <div class="panel-body" style="padding:0 0 4px;">
          <div id="disputeTableWrap" style="padding:0 4px;">
            <div style="padding:24px;"><div class="skel-line skeleton"></div><div class="skel-line skeleton" style="width:80%"></div></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Billing Variance</span>
          <span class="panel-tag" id="varianceTag">‚Äî</span>
        </div>
        <div class="panel-body">
          <div class="variance-meter" id="varianceMeter">
            <div class="variance-row"><span class="variance-label">Device Recorded</span><span class="variance-val" id="vDevice">‚Äî</span></div>
            <div class="variance-bar"><div class="variance-fill" id="vDeviceBar" style="width:0%;background:var(--accent)"></div></div>
            <div class="variance-row"><span class="variance-label">Telco Reported</span><span class="variance-val" id="vTelco">‚Äî</span></div>
            <div class="variance-bar"><div class="variance-fill" id="vTelcoBar" style="width:0%;background:var(--accent2)"></div></div>
            <div class="variance-row"><span class="variance-label">Variance (V)</span><span class="variance-val" style="color:var(--accent2)" id="vVariance">‚Äî</span></div>
          </div>
          <div style="height:1px;background:var(--border);margin:12px 0 20px;"></div>
          <div class="quick-actions">
            <a href="#" class="qa-btn"><span class="qa-icon">üìÑ</span><div><div class="qa-label">Generate Report</div><div class="qa-sub">Forensic PDF</div></div></a>
            <a href="#" class="qa-btn"><span class="qa-icon">üì®</span><div><div class="qa-label">File Dispute</div><div class="qa-sub">Submit to NCC</div></div></a>
            <a href="#" class="qa-btn"><span class="qa-icon">üì±</span><div><div class="qa-label">Add Device</div><div class="qa-sub">Register</div></div></a>
            <a href="#" class="qa-btn"><span class="qa-icon">üìä</span><div><div class="qa-label">Full Analytics</div><div class="qa-sub">30-day view</div></div></a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // Cursor
  const cursor=document.getElementById('cursor'),ring=document.getElementById('cursorRing');
  let mx=0,my=0,rx=0,ry=0;
  document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;cursor.style.left=mx+'px';cursor.style.top=my+'px';});
  (function anim(){rx+=(mx-rx)*0.12;ry+=(my-ry)*0.12;ring.style.left=rx+'px';ring.style.top=ry+'px';requestAnimationFrame(anim);})();
  document.querySelectorAll('a,button').forEach(el=>{el.addEventListener('mouseenter',()=>{ring.style.width='50px';ring.style.height='50px';});el.addEventListener('mouseleave',()=>{ring.style.width='36px';ring.style.height='36px';});});

  // Date
  document.getElementById('topbarDate').textContent = new Date().toLocaleDateString('en-GB',{weekday:'long',year:'numeric',month:'long',day:'numeric'});

  // Auth check
  const token = localStorage.getItem('aitelda_token');
  const user = JSON.parse(localStorage.getItem('aitelda_user') || '{}');
  if (!token) window.location.href = 'login.html';

  // User info
  const name = user.full_name || user.email || 'User';
  document.getElementById('userName').textContent = name;
  document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();

  const API = 'http://localhost:5000';
  const headers = { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' };

  function fmtBytes(b) {
    if (!b || b === 0) return '0 B';
    if (b < 1024) return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    if (b < 1073741824) return (b/1048576).toFixed(1) + ' MB';
    return (b/1073741824).toFixed(2) + ' GB';
  }

  async function loadDashboard() {
    try {
      // Summary
      const summRes = await fetch(`${API}/api/analytics/summary`, {headers});
      if (summRes.status === 401) { logout(); return; }
      const summ = (await summRes.json()).data;

      document.getElementById('statBytes').textContent = fmtBytes(summ.total_bytes_monitored);
      document.getElementById('statAnomalies').textContent = summ.anomalies_last_30_days;
      document.getElementById('statDisputes').textContent = summ.total_disputes;
      document.getElementById('statDevices').textContent = summ.registered_devices;

      const ds = summ.disputes || {};
      const resolved = ds.resolved || 0;
      document.getElementById('statDisputesSub').textContent = resolved > 0 ? `${resolved} resolved` : 'none resolved yet';

      // Variance from best dispute
      if (summ.highest_variance_dispute) {
        const hv = summ.highest_variance_dispute;
        document.getElementById('varianceTag').textContent = hv.variance_pct.toFixed(1) + '% variance';
        document.getElementById('varianceTag').style.color = hv.variance_pct > 5 ? 'var(--accent2)' : 'var(--accent)';
        document.getElementById('vVariance').textContent = hv.variance_pct.toFixed(2) + '%';
        document.getElementById('vDevice').textContent = '‚Äî';
        document.getElementById('vTelco').textContent = '‚Äî';
        document.getElementById('vDeviceBar').style.width = '70%';
        document.getElementById('vTelcoBar').style.width = '100%';
      } else {
        document.getElementById('varianceTag').textContent = 'No data yet';
        document.getElementById('vDevice').textContent = '‚Äî';
        document.getElementById('vTelco').textContent = '‚Äî';
        document.getElementById('vVariance').textContent = '‚Äî';
      }
    } catch(e) { console.warn('Summary load failed:', e); }

    // Load disputes
    try {
      const dispRes = await fetch(`${API}/api/disputes?limit=5`, {headers});
      const dispData = (await dispRes.json()).data;
      const disputes = dispData?.disputes || [];
      const wrap = document.getElementById('disputeTableWrap');
      if (disputes.length === 0) {
        wrap.innerHTML = `<div class="empty"><div class="empty-icon">‚öñÔ∏è</div><div class="empty-text">No disputes yet</div></div>`;
      } else {
        wrap.innerHTML = `<table class="dispute-table">
          <thead><tr><th>Reference</th><th>Period</th><th>Variance</th><th>Status</th><th></th></tr></thead>
          <tbody>${disputes.map(d=>`<tr>
            <td><span class="ref-code">${d.reference}</span></td>
            <td style="font-size:0.8rem;color:var(--muted)">${d.period_start?.slice(0,10)} ‚Üí ${d.period_end?.slice(0,10)}</td>
            <td style="font-family:'Space Mono',monospace;font-size:0.75rem;color:${d.variance_pct>5?'var(--accent2)':'var(--accent)'}">${d.variance_pct.toFixed(1)}%</td>
            <td><span class="status-badge ${d.status}">${d.status.replace('_',' ')}</span></td>
            <td><a href="#" class="action-btn">View</a></td>
          </tr>`).join('')}</tbody></table>`;
      }
    } catch(e) { document.getElementById('disputeTableWrap').innerHTML = `<div class="empty"><div class="empty-icon">‚öñÔ∏è</div><div class="empty-text">Connect backend to view disputes</div></div>`; }

    // Demo app data (would come from analytics API in production)
    const appColors = ['#00e5a0','#7b61ff','#ff4d00','#ffbd2e','#27c93f'];
    const demoApps = [
      {name:'TikTok',uid:'com.tiktok.musically',bytes:59000000,pct:91,emoji:'üéµ'},
      {name:'WhatsApp',uid:'com.whatsapp',bytes:6000000,pct:9,emoji:'üí¨'},
      {name:'Chrome',uid:'com.android.chrome',bytes:4200000,pct:6,emoji:'üåê'},
      {name:'Instagram',uid:'com.instagram.android',bytes:3100000,pct:5,emoji:'üì∑'},
      {name:'Gmail',uid:'com.google.android.gm',bytes:800000,pct:1,emoji:'üìß'},
    ];
    document.getElementById('appList').innerHTML = demoApps.map((app,i)=>`
      <div class="app-item">
        <div class="app-icon" style="background:${appColors[i]}22">${app.emoji}</div>
        <div style="flex:1;min-width:0;">
          <div class="app-name">${app.name}</div>
          <span class="app-uid">${app.uid}</span>
        </div>
        <div class="app-bar-wrap">
          <div class="app-bar"><div class="app-bar-fill" style="width:${app.pct}%;background:${appColors[i]}"></div></div>
          <div class="app-bytes">${fmtBytes(app.bytes)}</div>
        </div>
      </div>`).join('');

    // Demo anomalies
    const demoAnomalies = [
      {app:'com.tiktok.musically',detail:'+1730% deviation during idle ¬∑ Screen off',time:'02:14',sev:'high'},
      {app:'com.facebook.katana',detail:'+340% deviation ¬∑ Background fetch',time:'04:52',sev:'medium'},
      {app:'com.google.android.gms',detail:'+28% deviation ¬∑ System update',time:'07:11',sev:'low'},
    ];
    document.getElementById('anomalyCount').textContent = demoAnomalies.length + ' events';
    document.getElementById('anomalyBadge').textContent = demoAnomalies.length;
    document.getElementById('anomalyList').innerHTML = demoAnomalies.map(a=>`
      <div class="anomaly-item">
        <div class="anomaly-sev ${a.sev}"></div>
        <div style="flex:1">
          <div class="anomaly-app">${a.app}</div>
          <div class="anomaly-detail">${a.detail}</div>
        </div>
        <div class="anomaly-time">${a.time}</div>
      </div>`).join('');
  }

  function logout() {
    const refresh = localStorage.getItem('aitelda_refresh');
    if (refresh) fetch(`${API}/api/auth/logout`,{method:'POST',headers,body:JSON.stringify({refresh_token:refresh})}).catch(()=>{});
    localStorage.clear();
    window.location.href = 'login.html';
  }

  loadDashboard();
</script>
</body>
</html>
